# 第3章：正規化と正規化崩し

## お願い事項

- 基本的にマイクオンでお願いします
	- 何か反応がないと寂しい…。「あー」とか「うーん」とかリアクションがあると嬉しいです！
	- ただし、環境音が大きい場合は除く
- 質問は、随時受け付けます
	- いつでも話しかけてください:+1:

## 自己紹介

- 名前
	- このサーバのニックネームが本名です
	- HNは「yu-ki」とか「ゆーき」とか

- 職歴
	- SE歴13年目
	- 10年ほど金融系のコボラー(UNIX,Oracle,COBOLみたいな構成。少しだけ汎用機)
	- 2018年末からWebエンジニアに転向
	- 今はWindows,Linux,PostgreSQL,Java,HTML/CSS/JSで業務システム開発中

- Twitter
	- @yu_ki_209186
	- Discordのプロフィール欄から飛べます

- 宣伝
	- 読書猿氏著「独学大全」のファンコミュニティ「独学広場」をDiscord上で運営しています。
	- https://www.diamond.co.jp/book/9784478108536.html
	- Twitterのプロフ欄に招待リンクがありますので、よければ。

## おさらい

### 第1章：『かね玄』のデータモデル

- 本書でのデータモデルの書き方を紹介
	- https://shoheiimamura.github.io/data-modeling-catalog/chapter1

### 第2章：主キーの重要性

- 単独主キーと複合キー
- 名称やコードは主キーに向かない
- 定義域制約
- 条件付きの関数従属性と派生関係

## 本編

### 第3章：正規化と正規化崩し

- 「意味」から離れて考える

	- 図3-1

	- なぜデータ項目を記号に変換するのか？
		- 「データ構造をより形式的に見られるようになるし、データモデルのパターンとして応用しやすくなるから」
	
	- 一度記号に変換した後はずっと記号のまま扱うの？
		- そうではない
		- 「『文脈依存の世界』と『文脈非依存の世界』とを自在に行き来することが、データモデリングの面白さであり、難しさでもある」
		- 「データモデリングにおいて、データ項目の具体的な意味を理解する過程と、具体的な意味から離れて形式を検討する過程とがほぼパラレルに進行」する

	- 記号に置き換えてしまうなら、データ項目名は適当でいい？
		- そうではない
		- 「わかりやすい表現に積極的に置き換えてゆくべき」
		- 「データ項目に関して、文脈から離れて記号として眺められると同時に、項目の意味あいを支えられる的確な名称を思いつけることが、システム設計者に求められる職業適性」
	
	- 個人的によくわからなかったこと
		- データ項目名のくだりでユーザに受け入れられる/受け入れられないの話があったが、データ項目名がユーザの目に触れるところにも影響するということ？
		- フロント側の文言(アプリのメニュー名とか)とサーバ側の文言は一致していたほうがよいとは思う
		- でも、ユーザから見て、使い慣れた用語をシステム開発者に変えられるのってどうなんだろう？

- 「禁止」される関数従属性

	- 関数従属性ってなんだったっけ？
		- 図1-9
		- 一方の値を決めると、もう一方の値が決まる関係のこと

	- 図3-2

	- 「禁止」される関数従属性って？
		- データモデルで表現されていない関数従属性
			- それがあるなら、データモデルが誤っている
		- 推移的関数従属性
			- アノマリー(更新時異状)が起きるので、「禁止」とする(図3-3、3-4)

	- 個人的によくわからなかったこと
		- 例えば、図3-2に {m, p} → n がない。これはどう規定される？

- スナップショット属性

	- スナップショットとは？
		- （銃の）速射、スナップ写真という意味の英単語
		- ITの分野では、ある時点（瞬間）における対象の全体像を丸ごと写し取ったもの
		- https://e-words.jp/w/%E3%82%B9%E3%83%8A%E3%83%83%E3%83%97%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88.html

	- スナップショット属性とは？
		- 例えば、「仕入が起こった時点での商品の属性(それは長期的に変化し得ます)を『スナップショット(その時点での値)』として保持しておくこと」
		- 「過去の取引データを分析・集計する際に便利に使える」
	
	- スナップショット属性か推移的関数従属性かどう見分ける？
		- 「注釈を付加するか」
		- 名前を「『仕入時品種区分』のような表現に」する
		- 論理フィールド※にする
			- ※DB上に物理的に保持しない項目

- 導出型関数と枚挙型関数

	- 導出型関数とは？
		- 「関数上でプログラミング」して入力値に対応する出力値を算出する方法
		- 例えば、y = F(x) = 2x + 3

	- 枚挙型関数とは？
		- 「入力値に対応する出力値の組み合わせを用意して、機械に組み込んでしまう」方法
		- 例えば、y = F(x) = 西暦x年における東京の平均気温
		- 「業務システムに関わる関数従属性について見れば、おそらく8割方が枚挙型であるといっていいでしょう」

- 動的参照関係

- 正規化のための3つのルール

	- 入れ子構造の排除
	- 不要な関数従属性の排除
	- 有効な識別子の網羅

- 正規化崩しの3パターン

	- 論理フィールドの物理化
	- サロゲートキーの導入
	- テーブルの統合と抽象化



